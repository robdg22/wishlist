<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rive Multi-Artboard Showcase</title>
    <style>
      body {
        margin: 0;
        padding: 40px;
        font-family: Arial, sans-serif;
        min-height: 100vh;
      }

      .showcase-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 40px;
      }

      .buttons-section {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
        margin-bottom: 40px;
      }

      .button-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .rive-button-large {
        width: 108px;
        height: 108px;
        border-radius: 50%;
        background-color: white;
        border: none;
        padding: 0;
        position: relative;
        cursor: pointer;
        outline: none;
        transition: all 0.2s ease;
      }

      .rive-button-large:focus,
      .rive-button-large:hover {
        outline: none;
        /* Dynamic focus color will be set via JavaScript */
      }

      /* High contrast focus indicator for accessibility */
      .rive-button-large:focus-visible {
        outline: 3px solid #000;
        outline-offset: 4px;
      }

      /* Screen reader only text */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Skip link for keyboard navigation */
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: #000;
        color: #fff;
        padding: 8px;
        text-decoration: none;
        z-index: 1000;
        border-radius: 4px;
      }

      .skip-link:focus {
        top: 6px;
      }

      /* Live region for announcements */
      .live-region {
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }

      .canvas-large {
        width: 108px;
        height: 108px;
        display: block;
        border-radius: 50%;
        pointer-events: none;
      }

      .button-label {
        font-size: 16px;
        font-weight: 500;
        color: #333;
        text-align: center;
      }

      .color-controls {
        padding: 16px 30px 30px 30px;
        border: 1px solid #CCCCCC ;
      }

      .color-controls h2 {
        color: #333;
        margin-bottom: 20px;
        text-align: left;
      }

      .color-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
      }

      .color-control {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .color-control label {
        font-weight: 500;
        color: #555;
      }

      .color-input-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .color-input {
        width: 60px;
        height: 40px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }

      .color-hex {
        font-family: monospace;
        font-size: 14px;
        color: #666;
        min-width: 80px;
      }

      .reset-button {
        background: #00539F;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 20px;
      }

      .reset-button:hover {
        background: #003d7a;
      }

      .info-panel {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-bottom: 20px;
      }

      .debug-info {
        font-family: monospace;
        font-size: 12px;
        color: #666;
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="live-region" aria-live="polite" id="announcements"></div>
    
    <div class="showcase-container">
      <h1>Wishlist button animation</h1>
      
      <main id="main-content">
        <section class="buttons-section" role="group" aria-labelledby="buttons-heading">
          <h2 id="buttons-heading" class="sr-only">Animation buttons</h2>
          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="standardButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-standard" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Standard</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="beatButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-beat" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Beat</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="spinButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-spin" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Spin</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="spinDoubleButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-spin-double" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Spin Double</div>
          </div>
        </section>
      </main>

      <div class="color-controls">
        <h2>Choose colours</h2>
        <div class="color-grid">
          <div class="color-control">
            <label>Fill Colour</label>
            <div class="color-input-wrapper">
              <input type="color" id="fillColor" class="color-input" value="#E81C2D">
              <span class="color-hex" id="fillHex">#E81C2D</span>
            </div>
          </div>

          <div class="color-control">
            <label>Outline Colour</label>
            <div class="color-input-wrapper">
              <input type="color" id="outlineColor" class="color-input" value="#00539F">
              <span class="color-hex" id="outlineHex">#00539F</span>
            </div>
          </div>

          <div class="color-control">
            <label>Background Colour</label>
            <div class="color-input-wrapper">
              <input type="color" id="backgroundColor" class="color-input" value="#FFD2C3">
              <span class="color-hex" id="backgroundHex">#FFD2C3</span>
            </div>
          </div>
        </div>
        
        <button class="reset-button" id="resetColors">Reset to Defaults</button>
        
        <div class="debug-info" id="debugInfo">
          Debug info will appear here...
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/@rive-app/canvas"></script>
    <script>
      // Store all button states and instances
      const buttonStates = {};
      const riveInstances = {};

      // Color conversion utilities
      function hexToRgba(hex) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        // Return as ARGB format for Rive (alpha, red, green, blue)
        return (255 << 24) | (r << 16) | (g << 8) | b;
      }

      function updateDebugInfo(message) {
        const debugEl = document.getElementById('debugInfo');
        debugEl.textContent = message;
      }

      // Update button accessibility attributes
      function updateButtonAccessibility(buttonId, isSelected) {
        const button = document.getElementById(buttonId + 'Button');
        if (button) {
          const ariaLabel = isSelected ? 'Remove from wishlist' : 'Add to wishlist';
          button.setAttribute('aria-label', ariaLabel);
          button.setAttribute('aria-pressed', isSelected.toString());
          
          // Announce the change to screen readers
          const announcement = isSelected ? 'Added to wishlist' : 'Removed from wishlist';
          announceToScreenReader(announcement);
        }
      }

      // Announce changes to screen readers
      function announceToScreenReader(message) {
        const announcements = document.getElementById('announcements');
        if (announcements) {
          announcements.textContent = message;
          // Clear after a short delay so repeated actions are announced
          setTimeout(() => {
            announcements.textContent = '';
          }, 1000);
        }
      }

      // Generic click handler
      function handleButtonClick(buttonId, property) {
        if (property) {
          const currentValue = property.value;
          const newValue = !currentValue;
          property.value = newValue;
          
          // Update accessibility attributes
          updateButtonAccessibility(buttonId, newValue);
          
          console.log(`${buttonId} button - Toggled IsSelected to:`, newValue);
          updateDebugInfo(`${buttonId}: IsSelected = ${newValue}`);
        }
      }

      // Update focus state colors
      function updateFocusState() {
        const outlineColorHex = document.getElementById('outlineColor').value;
        
        // Create CSS rule for dynamic focus state
        const style = document.createElement('style');
        style.textContent = `
          .rive-button-large:focus,
          .rive-button-large:hover {
            outline: none;
            box-shadow: 0 0 0 3px white, 0 0 0 12px ${outlineColorHex} !important;
          }
        `;
        
        // Remove any existing dynamic focus styles
        const existingStyle = document.getElementById('dynamic-focus-style');
        if (existingStyle) {
          existingStyle.remove();
        }
        
        style.id = 'dynamic-focus-style';
        document.head.appendChild(style);
      }

      // Color update function
      function updateColors() {
        const fillColor = hexToRgba(document.getElementById('fillColor').value);
        const outlineColor = hexToRgba(document.getElementById('outlineColor').value);
        const backgroundColor = hexToRgba(document.getElementById('backgroundColor').value);

        // Update hex displays
        document.getElementById('fillHex').textContent = document.getElementById('fillColor').value;
        document.getElementById('outlineHex').textContent = document.getElementById('outlineColor').value;
        document.getElementById('backgroundHex').textContent = document.getElementById('backgroundColor').value;

        // Update focus state
        updateFocusState();

        // Update all button instances
        Object.values(riveInstances).forEach(instance => {
          const vmi = instance.viewModelInstance;
          if (vmi) {
            try {
              const fillProp = vmi.color('Fill');
              const outlineProp = vmi.color('Outline');
              const backgroundProp = vmi.color('Background');

              if (fillProp) fillProp.value = fillColor;
              if (outlineProp) outlineProp.value = outlineColor;
              if (backgroundProp) backgroundProp.value = backgroundColor;
            } catch (error) {
              console.warn('Error updating colors:', error);
            }
          }
        });

        updateDebugInfo(`Colors updated: Fill=${document.getElementById('fillColor').value}, Outline=${document.getElementById('outlineColor').value}, Background=${document.getElementById('backgroundColor').value}`);
      }

      // Create Rive instance for each artboard
      function createRiveInstance(artboardName, stateMachineName, canvasId, buttonId) {
        const instance = new rive.Rive({
          src: './wishlist.riv',
          canvas: document.getElementById(canvasId),
          autoplay: true,
          autoBind: true,
          artboard: artboardName,
          stateMachines: stateMachineName,
          onLoad: () => {
            console.log(`✅ ${buttonId} loaded (artboard: ${artboardName})`);
            
            const vmi = instance.viewModelInstance;
            if (vmi) {
              // Set initial state
              vmi.boolean('IsSelected').value = false;
              buttonStates[buttonId] = vmi.boolean('IsSelected');
              
              // Initialize accessibility attributes
              updateButtonAccessibility(buttonId, false);
              
              // Log available properties
              console.log(`${buttonId} properties:`, Object.keys(vmi));
              
              // Apply initial colors
              updateColors();
            }
            
            instance.resizeDrawingSurfaceToCanvas();
            updateDebugInfo(`${buttonId} loaded successfully`);
          },
          onLoadError: (error) => {
            console.error(`❌ ${buttonId} load error:`, error);
            updateDebugInfo(`${buttonId} failed to load`);
          }
        });

        riveInstances[buttonId] = instance;
        return instance;
      }

      // Initialize all buttons
      createRiveInstance('standard', 'standard', 'canvas-standard', 'standard');
      createRiveInstance('beat', 'beat', 'canvas-beat', 'beat');
      createRiveInstance('spin', 'spin', 'canvas-spin', 'spin');
      createRiveInstance('spinDouble', 'spinDouble', 'canvas-spin-double', 'spinDouble');

      // Add click handlers
      document.getElementById('standardButton').addEventListener('click', () => 
        handleButtonClick('standard', buttonStates.standard)
      );
      
      document.getElementById('beatButton').addEventListener('click', () => 
        handleButtonClick('beat', buttonStates.beat)
      );
      
      document.getElementById('spinButton').addEventListener('click', () => 
        handleButtonClick('spin', buttonStates.spin)
      );
      
      document.getElementById('spinDoubleButton').addEventListener('click', () => 
        handleButtonClick('spinDouble', buttonStates.spinDouble)
      );

      // Color control event listeners
      document.getElementById('fillColor').addEventListener('input', updateColors);
      document.getElementById('outlineColor').addEventListener('input', updateColors);
      document.getElementById('backgroundColor').addEventListener('input', updateColors);

      // Reset colors button
      document.getElementById('resetColors').addEventListener('click', () => {
        document.getElementById('fillColor').value = '#E81C2D';
        document.getElementById('outlineColor').value = '#00539F';
        document.getElementById('backgroundColor').value = '#FFD2C3';
        updateColors();
      });

      // Initial debug message
      updateDebugInfo('Initializing Rive instances...');
    </script>
  </body>
</html>