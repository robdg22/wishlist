<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rive Multi-Artboard Showcase</title>
    <style>
      body {
        margin: 0;
        padding: 40px;
        font-family: Arial, sans-serif;
        min-height: 100vh;
      }

      .showcase-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 40px;
      }

      .buttons-section {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
        margin-bottom: 40px;
      }

      .button-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .rive-button-large {
        width: 108px;
        height: 108px;
        border-radius: 50%;
        background-color: white;
        border: none;
        padding: 0;
        position: relative;
        cursor: pointer;
        outline: none;
        transition: all 0.2s ease;
      }

      .rive-button-large:focus,
      .rive-button-large:hover {
        outline: none;
        /* Dynamic focus color will be set via JavaScript */
      }

      /* High contrast focus indicator for accessibility */
      .rive-button-large:focus-visible {
        outline: 3px solid #000;
        outline-offset: 4px;
      }

      /* Screen reader only text */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Skip link for keyboard navigation */
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: #000;
        color: #fff;
        padding: 8px;
        text-decoration: none;
        z-index: 1000;
        border-radius: 4px;
      }

      .skip-link:focus {
        top: 6px;
      }

      /* Live region for announcements */
      .live-region {
        position: absolute;
        left: -10000px;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }

      .canvas-large {
        width: 108px;
        height: 108px;
        display: block;
        border-radius: 50%;
        pointer-events: none;
      }

      .button-label {
        font-size: 16px;
        font-weight: 500;
        color: #333;
        text-align: center;
      }

      .color-controls {
        padding: 20px 30px 30px 30px;
        border: 1px solid #CCCCCC;
      }

      .color-controls h2 {
        color: #333;
        margin-bottom: 20px;
        text-align: left;
      }

      .color-mode-section {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      .radio-group {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .radio-option {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .radio-option input[type="radio"] {
        margin: 0;
      }

      .color-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
      }

      .color-control {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .color-control label {
        font-weight: 500;
        color: #555;
        font-size: 16px;
      }

      .color-preset-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .color-preset-btn {
        width: 50px;
        height: 40px;
        border: 2px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
      }

      .color-preset-btn:hover {
        transform: scale(1.05);
        border-color: #999;
      }

      .color-preset-btn.active {
        border-color: #000;
        border-width: 3px;
      }

      .color-picker-btn {
        width: 50px;
        height: 40px;
        border: 2px solid #ddd;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: #f5f5f5;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: bold;
        color: #666;
      }

      .color-picker-btn:hover {
        transform: scale(1.05);
        border-color: #999;
        background: #e9e9e9;
      }

      .color-preset-section {
        margin-bottom: 25px;
      }


      .action-buttons {
        display: flex;
        gap: 12px;
        margin-top: 25px;
        flex-wrap: wrap;
      }

      .action-btn {
        background: #00539F;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s ease;
      }

      .action-btn:hover {
        background: #003d7a;
      }

      .action-btn.secondary {
        background: #666;
      }

      .action-btn.secondary:hover {
        background: #444;
      }

      .disabled {
        opacity: 0.5;
        pointer-events: none;
      }

      .info-panel {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-bottom: 20px;
      }

    </style>
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="live-region" aria-live="polite" id="announcements"></div>
    
    <div class="showcase-container">
      <h1>Wishlist button animation</h1>
      
      <main id="main-content">
        <section class="buttons-section" role="group" aria-labelledby="buttons-heading">
          <h2 id="buttons-heading" class="sr-only">Animation buttons</h2>
          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="standardButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-standard" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Standard</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="beatButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-beat" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Beat</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="spinButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-spin" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Spin</div>
          </div>

          <div class="button-item">
            <button 
              class="rive-button-large" 
              id="spinDoubleButton"
              aria-label="Add to wishlist"
              aria-pressed="false"
              type="button">
              <canvas class="canvas-large" id="canvas-spin-double" aria-hidden="true"></canvas>
            </button>
            <div class="button-label" aria-hidden="true">Spin Double</div>
          </div>
        </section>
      </main>

      <div class="color-controls">
        
        <div class="color-preset-section">
          <h3>Color Presets</h3>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="colorPreset" value="blue" id="bluePreset" checked>
              <span>Blue</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="colorPreset" value="red" id="redPreset">
              <span>Red</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="colorPreset" value="neutral" id="neutralPreset">
              <span>Neutral</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="colorPreset" value="custom" id="customPreset">
              <span>Custom</span>
            </label>
          </div>
        </div>

        <div class="custom-controls" id="customControls" style="display: none;">
          <div class="color-mode-section">
            <h3>Color Mode</h3>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="colorMode" value="2" id="twoColorMode">
                <span>2 colours</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="colorMode" value="3" id="threeColorMode" checked>
                <span>3 colours</span>
              </label>
            </div>
          </div>

          <div class="color-grid">
            <div class="color-control">
              <label>Fill</label>
              <div class="color-preset-buttons" id="fillPresets">
                <button class="color-preset-btn" data-color="#E81C2D" style="background-color: #E81C2D;"></button>
                <button class="color-preset-btn" data-color="#00539F" style="background-color: #00539F;"></button>
                <button class="color-preset-btn" data-color="#333333" style="background-color: #333333;"></button>
                <button class="color-preset-btn" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                <button class="color-preset-btn" data-color="#FFD2C3" style="background-color: #FFD2C3;"></button>
                <button class="color-picker-btn" id="fillColorPicker">+</button>
              </div>
            </div>

            <div class="color-control">
              <label>Outline</label>
              <div class="color-preset-buttons" id="outlinePresets">
                <button class="color-preset-btn" data-color="#E81C2D" style="background-color: #E81C2D;"></button>
                <button class="color-preset-btn" data-color="#00539F" style="background-color: #00539F;"></button>
                <button class="color-preset-btn" data-color="#333333" style="background-color: #333333;"></button>
                <button class="color-preset-btn" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                <button class="color-preset-btn" data-color="#FFD2C3" style="background-color: #FFD2C3;"></button>
                <button class="color-picker-btn" id="outlineColorPicker">+</button>
              </div>
            </div>

            <div class="color-control" id="backgroundControl">
              <label>Background</label>
              <div class="color-preset-buttons" id="backgroundPresets">
                <button class="color-preset-btn" data-color="#E81C2D" style="background-color: #E81C2D;"></button>
                <button class="color-preset-btn" data-color="#00539F" style="background-color: #00539F;"></button>
                <button class="color-preset-btn" data-color="#333333" style="background-color: #333333;"></button>
                <button class="color-preset-btn" data-color="#FFFFFF" style="background-color: #FFFFFF;"></button>
                <button class="color-preset-btn" data-color="#FFD2C3" style="background-color: #FFD2C3;"></button>
                <button class="color-picker-btn" id="backgroundColorPicker">+</button>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="action-btn" id="swapColors">Swap Colors</button>
            <button class="action-btn secondary" id="resetColors">Reset to Defaults</button>
          </div>
        </div>
        

        <!-- Hidden color inputs for the color picker functionality -->
        <input type="color" id="fillColorInput" style="display: none;">
        <input type="color" id="outlineColorInput" style="display: none;">
        <input type="color" id="backgroundColorInput" style="display: none;">
      </div>
    </div>

    <script src="https://unpkg.com/@rive-app/canvas"></script>
    <script>
      // Store all button states and instances
      const buttonStates = {};
      const riveInstances = {};

      // Current color selections
      let currentColors = {
        fill: '#FFFFFF',
        outline: '#00539F', 
        background: '#FFD2C3'
      };

      let colorMode = '3'; // '2' or '3'
      let currentPreset = 'blue'; // 'blue', 'red', 'neutral', 'custom'

      // Color presets
      const presets = {
        blue: { fill: '#FFFFFF', outline: '#00539F', background: '#00539F' },
        red: { fill: '#FFFFFF', outline: '#E81C2D', background: '#E81C2D' },
        neutral: { fill: '#FFFFFF', outline: '#333333', background: '#333333' }
      };

      // Color conversion utilities
      function hexToRgba(hex) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        // Return as ARGB format for Rive (alpha, red, green, blue)
        return (255 << 24) | (r << 16) | (g << 8) | b;
      }


      // Update button accessibility attributes
      function updateButtonAccessibility(buttonId, isSelected) {
        const button = document.getElementById(buttonId + 'Button');
        if (button) {
          const ariaLabel = isSelected ? 'Remove from wishlist' : 'Add to wishlist';
          button.setAttribute('aria-label', ariaLabel);
          button.setAttribute('aria-pressed', isSelected.toString());
          
          // Announce the change to screen readers
          const announcement = isSelected ? 'Added to wishlist' : 'Removed from wishlist';
          announceToScreenReader(announcement);
        }
      }

      // Announce changes to screen readers
      function announceToScreenReader(message) {
        const announcements = document.getElementById('announcements');
        if (announcements) {
          announcements.textContent = message;
          // Clear after a short delay so repeated actions are announced
          setTimeout(() => {
            announcements.textContent = '';
          }, 1000);
        }
      }

      // Generic click handler
      function handleButtonClick(buttonId, property) {
        if (property) {
          const currentValue = property.value;
          const newValue = !currentValue;
          property.value = newValue;
          
          // Update accessibility attributes
          updateButtonAccessibility(buttonId, newValue);
          
          console.log(`${buttonId} button - Toggled IsSelected to:`, newValue);
        }
      }

      // Update focus state colors
      function updateFocusState() {
        const outlineColorHex = currentColors.outline;
        
        // Create CSS rule for dynamic focus state
        const style = document.createElement('style');
        style.textContent = `
          .rive-button-large:focus,
          .rive-button-large:hover {
            outline: none;
            box-shadow: 0 0 0 3px white, 0 0 0 12px ${outlineColorHex} !important;
          }
        `;
        
        // Remove any existing dynamic focus styles
        const existingStyle = document.getElementById('dynamic-focus-style');
        if (existingStyle) {
          existingStyle.remove();
        }
        
        style.id = 'dynamic-focus-style';
        document.head.appendChild(style);
      }

      // Update active button states
      function updateActiveButtons() {
        // Clear all active states
        document.querySelectorAll('.color-preset-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // Set active states based on current colors
        document.querySelectorAll(`#fillPresets .color-preset-btn[data-color="${currentColors.fill}"]`).forEach(btn => {
          btn.classList.add('active');
        });
        document.querySelectorAll(`#outlinePresets .color-preset-btn[data-color="${currentColors.outline}"]`).forEach(btn => {
          btn.classList.add('active');
        });
        document.querySelectorAll(`#backgroundPresets .color-preset-btn[data-color="${currentColors.background}"]`).forEach(btn => {
          btn.classList.add('active');
        });
      }

      // Apply color preset
      function applyPreset(preset) {
        const customControls = document.getElementById('customControls');
        
        if (preset === 'custom') {
          // Show custom controls but don't change colors
          customControls.style.display = 'block';
          currentPreset = preset;
          updateActiveButtons();
        } else if (presets[preset]) {
          // Apply preset colors and hide custom controls
          currentColors = { ...presets[preset] };
          currentPreset = preset;
          customControls.style.display = 'none';
          updateActiveButtons();
          updateColors();
        }
      }

      // Handle color mode changes
      function updateColorMode() {
        const backgroundControl = document.getElementById('backgroundControl');
        
        if (colorMode === '2') {
          // In 2-color mode, background matches outline
          currentColors.background = currentColors.outline;
          backgroundControl.classList.add('disabled');
        } else {
          // In 3-color mode, background is independent
          backgroundControl.classList.remove('disabled');
        }
        
        updateActiveButtons();
        updateColors();
      }

      // Color update function
      function updateColors() {
        const fillColor = hexToRgba(currentColors.fill);
        const outlineColor = hexToRgba(currentColors.outline);
        const backgroundColor = hexToRgba(currentColors.background);

        // Update focus state
        updateFocusState();

        // Update all button instances
        console.log('Available Rive instances:', Object.keys(riveInstances));
        Object.entries(riveInstances).forEach(([buttonId, instance]) => {
          console.log(`Updating colors for ${buttonId}...`);
          const vmi = instance.viewModelInstance;
          if (vmi) {
            try {
              const fillProp = vmi.color('Fill');
              const outlineProp = vmi.color('Outline');
              const backgroundProp = vmi.color('Background');

              console.log(`${buttonId} - Fill:`, fillProp ? 'found' : 'missing', 
                         'Outline:', outlineProp ? 'found' : 'missing',
                         'Background:', backgroundProp ? 'found' : 'missing');

              if (fillProp) fillProp.value = fillColor;
              if (outlineProp) outlineProp.value = outlineColor;
              if (backgroundProp) backgroundProp.value = backgroundColor;
            } catch (error) {
              console.warn(`Error updating colors for ${buttonId}:`, error);
            }
          } else {
            console.warn(`No view model instance for ${buttonId}`);
          }
        });

      }

      // Create Rive instance for each artboard
      function createRiveInstance(artboardName, stateMachineName, canvasId, buttonId) {
        const instance = new rive.Rive({
          src: './wishlist.riv',
          canvas: document.getElementById(canvasId),
          autoplay: true,
          autoBind: true,
          artboard: artboardName,
          stateMachines: stateMachineName,
          onLoad: () => {
            console.log(`✅ ${buttonId} loaded (artboard: ${artboardName})`);
            
            const vmi = instance.viewModelInstance;
            if (vmi) {
              // Set initial state
              vmi.boolean('IsSelected').value = false;
              buttonStates[buttonId] = vmi.boolean('IsSelected');
              
              // Initialize accessibility attributes
              updateButtonAccessibility(buttonId, false);
              
              // Log available properties
              console.log(`${buttonId} properties:`, Object.keys(vmi));
              
              // Apply initial colors
              updateColors();
            }
            
            instance.resizeDrawingSurfaceToCanvas();
          },
          onLoadError: (error) => {
            console.error(`❌ ${buttonId} load error:`, error);
          }
        });

        riveInstances[buttonId] = instance;
        return instance;
      }

      // Initialize all buttons
      createRiveInstance('standard', 'standard', 'canvas-standard', 'standard');
      createRiveInstance('beat', 'beat', 'canvas-beat', 'beat');
      createRiveInstance('spin', 'spin', 'canvas-spin', 'spin');
      createRiveInstance('spinDouble', 'spinDouble', 'canvas-spin-double', 'spinDouble');

      // Add click handlers
      document.getElementById('standardButton').addEventListener('click', () => 
        handleButtonClick('standard', buttonStates.standard)
      );
      
      document.getElementById('beatButton').addEventListener('click', () => 
        handleButtonClick('beat', buttonStates.beat)
      );
      
      document.getElementById('spinButton').addEventListener('click', () => 
        handleButtonClick('spin', buttonStates.spin)
      );
      
      document.getElementById('spinDoubleButton').addEventListener('click', () => 
        handleButtonClick('spinDouble', buttonStates.spinDouble)
      );

      // Color preset radio button listeners
      document.getElementById('bluePreset').addEventListener('change', (e) => {
        if (e.target.checked) applyPreset('blue');
      });

      document.getElementById('redPreset').addEventListener('change', (e) => {
        if (e.target.checked) applyPreset('red');
      });

      document.getElementById('neutralPreset').addEventListener('change', (e) => {
        if (e.target.checked) applyPreset('neutral');
      });

      document.getElementById('customPreset').addEventListener('change', (e) => {
        if (e.target.checked) applyPreset('custom');
      });

      // Color mode radio button listeners (for custom mode)
      document.getElementById('twoColorMode').addEventListener('change', (e) => {
        if (e.target.checked) {
          colorMode = '2';
          updateColorMode();
        }
      });

      document.getElementById('threeColorMode').addEventListener('change', (e) => {
        if (e.target.checked) {
          colorMode = '3';
          updateColorMode();
        }
      });

      // Color preset button listeners
      function setupColorPresetListeners() {
        // Fill color presets
        document.querySelectorAll('#fillPresets .color-preset-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            currentColors.fill = btn.dataset.color;
            currentPreset = 'custom';
            document.getElementById('customPreset').checked = true;
            updateActiveButtons();
            updateColors();
          });
        });

        // Outline color presets
        document.querySelectorAll('#outlinePresets .color-preset-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            currentColors.outline = btn.dataset.color;
            if (colorMode === '2') {
              currentColors.background = btn.dataset.color; // Sync background in 2-color mode
            }
            currentPreset = 'custom';
            document.getElementById('customPreset').checked = true;
            updateActiveButtons();
            updateColors();
          });
        });

        // Background color presets (only active in 3-color mode)
        document.querySelectorAll('#backgroundPresets .color-preset-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            if (colorMode === '3') {
              currentColors.background = btn.dataset.color;
              currentPreset = 'custom';
              document.getElementById('customPreset').checked = true;
              updateActiveButtons();
              updateColors();
            }
          });
        });

        // Color picker buttons
        document.getElementById('fillColorPicker').addEventListener('click', () => {
          document.getElementById('fillColorInput').click();
        });

        document.getElementById('outlineColorPicker').addEventListener('click', () => {
          document.getElementById('outlineColorInput').click();
        });

        document.getElementById('backgroundColorPicker').addEventListener('click', () => {
          document.getElementById('backgroundColorInput').click();
        });

        // Color input listeners
        document.getElementById('fillColorInput').addEventListener('change', (e) => {
          currentColors.fill = e.target.value;
          currentPreset = 'custom';
          document.getElementById('customPreset').checked = true;
          updateActiveButtons();
          updateColors();
        });

        document.getElementById('outlineColorInput').addEventListener('change', (e) => {
          currentColors.outline = e.target.value;
          if (colorMode === '2') {
            currentColors.background = e.target.value;
          }
          currentPreset = 'custom';
          document.getElementById('customPreset').checked = true;
          updateActiveButtons();
          updateColors();
        });

        document.getElementById('backgroundColorInput').addEventListener('change', (e) => {
          if (colorMode === '3') {
            currentColors.background = e.target.value;
            currentPreset = 'custom';
            document.getElementById('customPreset').checked = true;
            updateActiveButtons();
            updateColors();
          }
        });
      }

      // Swap colors function
      function swapColors() {
        const temp = currentColors.fill;
        currentColors.fill = currentColors.outline;
        currentColors.outline = temp;
        
        if (colorMode === '2') {
          currentColors.background = currentColors.outline; // Keep background synced
        }
        
        updateActiveButtons();
        updateColors();
        announceToScreenReader('Colors swapped');
      }

      // Reset colors button
      document.getElementById('resetColors').addEventListener('click', () => {
        applyPreset('blue');
        document.getElementById('bluePreset').checked = true;
        colorMode = '3';
        document.getElementById('threeColorMode').checked = true;
        announceToScreenReader('Colors reset to blue preset');
      });

      // Swap colors button
      document.getElementById('swapColors').addEventListener('click', swapColors);

      // Initialize the preset system
      setupColorPresetListeners();
      
      // Apply initial preset (blue)
      applyPreset('blue');

    </script>
  </body>
</html>